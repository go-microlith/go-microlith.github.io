<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.50-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Subdomains :: Microlith</title>

    
    <link href="/css/nucleus.css?1542658311" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1542658311" rel="stylesheet">
    <link href="/css/hybrid.css?1542658311" rel="stylesheet">
    <link href="/css/featherlight.min.css?1542658311" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1542658311" rel="stylesheet">
    <link href="/css/auto-complete.css?1542658311" rel="stylesheet">
    <link href="/css/theme.css?1542658311" rel="stylesheet">
    <link href="/css/hugo-theme.css?1542658311" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1542658311" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1542658311"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/tutorial/subdomains/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://microlith-framework.com/">
  <svg id="grav-logo" width="100%" height="100%" viewBox="0 0 504 140" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M235.832,71.564l-7.98,-0.001c-1.213,0.001 -2.197,0.987 -2.197,2.204l0,15.327l-0.158,0.132c-4.696,3.962 -10.634,6.14 -16.719,6.14c-14.356,0 -26.034,-11.68 -26.034,-26.037c0,-14.358 11.678,-26.035 26.034,-26.035c5.582,0 10.919,1.767 15.437,5.113c0.877,0.649 2.093,0.56 2.866,-0.211l5.69,-5.69c0.444,-0.442 0.675,-1.055 0.639,-1.681c-0.034,-0.627 -0.336,-1.206 -0.828,-1.597c-6.76,-5.363 -15.214,-8.314 -23.805,-8.314c-21.18,0 -38.414,17.233 -38.414,38.415c0,21.183 17.234,38.415 38.414,38.415c10.937,0 21.397,-4.705 28.698,-12.914c0.358,-0.403 0.556,-0.921 0.556,-1.46l0,-19.603c0,-1.217 -0.985,-2.203 -2.2,-2.203"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M502.794,34.445c-0.408,-0.616 -1.1,-0.989 -1.838,-0.989l-8.684,0c-0.879,0 -1.673,0.522 -2.022,1.329l-24.483,56.839l-24.92,-56.852c-0.352,-0.799 -1.142,-1.316 -2.012,-1.316l-8.713,0c-0.744,0 -1.44,0.373 -1.843,0.995c-0.408,0.623 -0.476,1.408 -0.174,2.09l30.186,68.858c0.352,0.799 1.143,1.317 2.017,1.317l10.992,0c0.879,0 1.673,-0.527 2.021,-1.329l29.655,-68.861c0.289,-0.68 0.222,-1.461 -0.182,-2.081"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M388.683,34.772c-0.353,-0.798 -1.142,-1.316 -2.017,-1.316l-10.988,0c-0.879,0 -1.673,0.522 -2.021,1.329l-29.655,68.861c-0.294,0.675 -0.226,1.46 0.182,2.077c0.407,0.619 1.096,0.993 1.838,0.993l8.684,0c0.879,0 1.673,-0.526 2.022,-1.329l24.478,-56.842l24.92,56.854c0.353,0.798 1.143,1.317 2.013,1.317l8.717,0c0.744,0 1.44,-0.374 1.843,-0.993c0.408,-0.624 0.471,-1.41 0.174,-2.094l-30.19,-68.857Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M309.196,81.525l0.476,-0.229c8.675,-4.191 14.279,-13.087 14.279,-22.667c0,-13.881 -11.295,-25.174 -25.176,-25.174l-31.863,0c-1.214,0 -2.199,0.988 -2.199,2.202l0,68.855c0,1.219 0.985,2.204 2.199,2.204l7.979,0c1.214,0 2.2,-0.985 2.2,-2.204l0,-58.679l21.684,0c7.059,0 12.799,5.739 12.799,12.796c0,5.885 -3.996,10.989 -9.728,12.408c-1.032,0.261 -2.064,0.393 -3.071,0.393l-7.977,0c-0.829,0 -1.585,0.467 -1.959,1.205c-0.378,0.74 -0.305,1.625 0.187,2.296l22.62,30.884c0.412,0.566 1.07,0.901 1.771,0.901l9.915,0c0.827,0 1.587,-0.467 1.96,-1.207c0.378,-0.742 0.302,-1.629 -0.186,-2.296l-15.91,-21.688Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M107.191,80.969c-7.255,-4.794 -11.4,-8.845 -15.011,-16.109c-2.47,4.977 -8.236,12.376 -17.962,18.198c-4.856,15.106 -27.954,44.015 -35.43,39.916c-2.213,-1.212 -2.633,-2.808 -2.133,-4.456c0.536,-4.129 9.078,-13.62 9.078,-13.62c0,0 0.18,1.992 2.913,6.187c-3.609,-11.205 5.965,-25.031 8.5,-29.738c3.985,-1.269 4.274,-6.387 4.274,-6.387c0.255,-7.909 -3.278,-13.635 -6.701,-17.059c2.459,3.002 3.255,7.539 3.372,11.694l0,0.023c0.012,0.469 0.012,0.93 0.011,1.39c-0.117,3.439 -1.157,8.19 -3.383,8.19l0.006,0.03c-2.289,-0.098 -5.115,0.391 -7.639,1.18l-5.582,1.334c0,0 2.977,-0.136 4.584,1.252c-1.79,2.915 -5.769,6.533 -10.206,8.588c-6.457,2.995 -8.312,-2.964 -5.034,-6.838c0.805,-0.946 1.618,-1.745 2.387,-2.399c-0.495,-0.513 -0.807,-1.198 -0.889,-2.068c-0.001,-0.005 -0.004,-0.009 -0.005,-0.013c-0.45,-1.977 -0.202,-4.543 2.596,-8.623c0.551,-0.863 1.214,-1.748 2.007,-2.647c0.025,-0.031 0.046,-0.059 0.072,-0.089c0.034,-0.042 0.072,-0.08 0.108,-0.121c0.02,-0.023 0.039,-0.045 0.059,-0.068c0.2,-0.228 0.413,-0.45 0.639,-0.663c3.334,-3.414 8.599,-6.966 16.897,-10.152c9.675,-14.223 13.219,-16.89 13.219,-16.89c1.071,-1.096 2.943,-2.458 3.632,-2.805c-5.053,-8.781 -6.074,-21.158 -4.75,-24.493c-0.107,0.18 -0.206,0.365 -0.287,0.556c0.49,-1.143 0.819,-1.509 1.328,-2.111c1.381,-1.632 6.058,-2.488 7.737,0.971c0.895,1.844 1.063,4.232 1.034,6.023c-3.704,-0.193 -7.063,4.036 -7.063,4.036c0,0 3.067,-1.448 6.879,-1.473c0,0 1.015,0.883 2.283,2.542c-1.712,3.213 -4.524,10.021 -2.488,17.168c0.338,1.408 0.849,2.619 1.483,3.648c0.024,0.045 0.044,0.089 0.069,0.135c0.051,0.066 0.096,0.122 0.144,0.183c3.368,5.072 9.542,5.665 9.542,5.665c-2.906,-1.45 -5.274,-3.76 -6.816,-6.56c-0.8,-1.498 -1.291,-2.762 -1.592,-3.761c-1.636,-6.313 0.771,-9.999 2.149,-12.471c3.17,-4.917 8.944,-7.893 15.151,-7.185c8.712,0.995 14.968,8.862 13.973,17.571c-0.608,5.321 -3.781,9.723 -8.142,12.117c1.049,2.839 -0.073,6.28 -0.073,6.28c2.642,3.323 2.758,5.238 2.667,7.017c-3.357,-0.565 -6.618,1.701 -6.618,1.701c0,0 6.476,-1.546 10.238,1.81c2.446,2.631 4.078,5.009 5.051,6.766c1.393,2.505 7.859,2.683 7.123,7.188c-0.737,4.499 -5.669,4.542 -13.401,-0.56M69.571,0c-38.424,0 -69.571,31.148 -69.571,69.567c0,38.422 31.147,69.573 69.571,69.573c38.42,0 69.568,-31.151 69.568,-69.573c0,-38.42 -31.148,-69.567 -69.568,-69.567"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M73.796,51.693c0.813,-0.814 0.813,-2.134 0,-2.947c-0.815,-0.814 -2.133,-0.814 -2.947,0c-0.815,0.813 -0.815,2.133 0,2.947c0.814,0.813 2.132,0.813 2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M66.445,53.149c-0.814,0.813 -0.814,2.133 0,2.947c0.813,0.814 2.133,0.814 2.947,0c0.813,-0.814 0.813,-2.134 0,-2.947c-0.814,-0.813 -2.134,-0.813 -2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M79.231,54.233c-1.274,-1.274 -3.339,-1.272 -4.611,0l-2.713,2.712c-1.274,1.275 -1.274,3.339 0,4.612l2.978,2.978c1.274,1.275 3.338,1.274 4.611,0l2.712,-2.712c1.274,-1.274 1.274,-3.339 0,-4.612l-2.977,-2.978Z" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M95.759,41.445c-2.151,-2.578 1.869,-7.257 4.391,-4.463c4.645,5.148 -2.237,7.041 -4.391,4.463M105.004,44.132c3.442,-6.553 -1.427,-10.381 -4.773,-13.523c-5.36,-5.039 -10.706,-7.217 -16.811,-0.241c-6.102,6.977 -2.226,15.068 3.356,19.061c5.584,3.994 14.782,1.255 18.228,-5.297"
      style="fill:#000;fill-rule:nonzero;"></path>
  </svg>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1542658311"></script>
<script type="text/javascript" src="/js/auto-complete.js?1542658311"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/microlith-framework.com\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1542658311"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/intro/" title="Ship" class="dd-item 
        
        
        
        ">
      <a href="/intro/">
          Microlith
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/intro/services/" title="Services" class="dd-item ">
        <a href="/intro/services/">
        Services
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/lambdas/" title="Lambdas" class="dd-item ">
        <a href="/intro/lambdas/">
        Lambdas
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/domain/" title="Domains" class="dd-item ">
        <a href="/intro/domain/">
        Domains
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/application/" title="Application" class="dd-item ">
        <a href="/intro/application/">
        Application
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/package/" title="Package" class="dd-item ">
        <a href="/intro/package/">
        Package
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/ship/" title="Ship" class="dd-item ">
        <a href="/intro/ship/">
        Ship
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/intro/fin/" title="Fin." class="dd-item ">
        <a href="/intro/fin/">
        Fin
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/prerequisites/" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/prerequisites/">
          Prerequisites
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/prerequisites/route53/" title="Route53 DNS" class="dd-item ">
        <a href="/prerequisites/route53/">
        Route53
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/prerequisites/github/" title="GitHub Access Token" class="dd-item ">
        <a href="/prerequisites/github/">
        GitHub
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/tutorial/" title="Tutorial" class="dd-item 
        parent
        
        
        ">
      <a href="/tutorial/">
          Tutorial
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/tutorial/bootstrap/" title="Getting Started" class="dd-item ">
        <a href="/tutorial/bootstrap/">
        Getting Started
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorial/root/" title="Hello, World!" class="dd-item ">
        <a href="/tutorial/root/">
        Hello, World!
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorial/services/" title="Services" class="dd-item ">
        <a href="/tutorial/services/">
        Services
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorial/channels/" title="Channels" class="dd-item ">
        <a href="/tutorial/channels/">
        Channels
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorial/subdomains/" title="Subdomains" class="dd-item active">
        <a href="/tutorial/subdomains/">
        Subdomains
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorial/globals/" title="Globals" class="dd-item ">
        <a href="/tutorial/globals/">
        Globals
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/resources/" title="Resources" class="dd-item 
        
        
        
        ">
      <a href="/resources/">
          Resources
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/resources/blob/" title="Buckets" class="dd-item ">
        <a href="/resources/blob/">
        Buckets
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/resources/stor/" title="Tables" class="dd-item ">
        <a href="/resources/stor/">
        Tables
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/resources/strm/" title="Streams" class="dd-item ">
        <a href="/resources/strm/">
        Streams
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/resources/rest/" title="Endpoints" class="dd-item ">
        <a href="/resources/rest/">
        Endpoints
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/resources/cron/" title="Schedued Jobs" class="dd-item ">
        <a href="/resources/cron/">
        Jobs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/resources/inst/" title="Log Readers" class="dd-item ">
        <a href="/resources/inst/">
        Logs
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/examples/" title="Examples" class="dd-item 
        
        
        
        ">
      <a href="/examples/">
          Examples
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/examples/tutorial/" title="Tutorial" class="dd-item ">
        <a href="/examples/tutorial/">
        Tutorial
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/examples/blog/" title="Blog" class="dd-item ">
        <a href="/examples/blog/">
        Blog
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cleanup/" title="Teardown Instructions" class="dd-item 
        
        
        
        ">
      <a href="/cleanup/">
          Teardown
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/go-microlith/microlith"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Microlith</a> > <a href='/tutorial/'>Tutorial</a> > Subdomains
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#the-sub-domain">The Sub Domain</a>
<ul>
<li><a href="#the-requests-channel">The &ldquo;requests&rdquo; Channel</a></li>
<li><a href="#the-hello-and-world-services">The &ldquo;hello&rdquo; and &ldquo;world&rdquo; Services</a></li>
<li><a href="#the-hello-subdomain-world-endpoint">The &ldquo;hello-subdomain-world&rdquo; Endpoint</a></li>
<li><a href="#the-hellosubdomainworld-method">The HelloSubdomainWorld() Method</a></li>
</ul></li>
<li><a href="#the-root-domain">The Root Domain</a>
<ul>
<li><a href="#domain-instance">Domain Instance</a></li>
<li><a href="#the-proxy-to-subdomain-endpoint">The &ldquo;proxy-to-subdomain&rdquo; Endpoint</a></li>
</ul></li>
<li><a href="#ship-it">Ship It</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Subdomains</h1>
          

        




<p>The application has a root domain and a set of subdomains, and it routes traffic to them using DNS.  Each domain&rsquo;s origin is mounted under a single DNS name.  The root domain is mounted at the base DNS name you specified during the bootstrap process.  The subdomains are named using subdomain prefixes, and are mounted as subdomains of the base DNS name.</p>

<p>Let&rsquo;s create a domain named &ldquo;sub&rdquo; that mirrors the root domain.  The origin will have one endpoint that returns &ldquo;Hello, subdomain world!&rdquo;.  Like the root domain, it have a &ldquo;hello&rdquo; and a &ldquo;world&rdquo; service and have a channel for request events.</p>

<h2 id="the-sub-domain">The Sub Domain</h2>

<p>Microlith domains are objects which implement the <a href="https://godoc.org/gopkg.in/microlith.v0/sam/tld#Domain">Domain</a> interface.  Like a service, a domain built with a builder DSL and its public methods call endpoints on the domain.</p>

<p>We&rsquo;ll create a Sub object to represent the domain.  All of top-level vars in the root domain are instance variables in the Sub domain.</p>

<pre><code class="language-go">type Sub struct {
  helloSvc *Word
  worldSvc *Word
  requests *strm.Stream
  endpoint *rest.Endpoint
}

func NewSub() *Sub {
  return new(Sub)
}

func (sub *Sub) Build(domain *tld.DomainBuilder) {
  // TODO
}

func (sub *Sub) HelloSubdomainWorld(ctx context.Context) (string, error) {
  // TODO
}
</code></pre>

<h3 id="the-requests-channel">The &ldquo;requests&rdquo; Channel</h3>

<p>We are going to reuse our Word service in the domain, and that requires a channel with request events.  Use the <a href="https://godoc.org/gopkg.in/microlith.v0/sam/tld#Domain.Channel">Channel()</a> method on the domain builder to create a channel.</p>

<pre><code class="language-go">func (sub *Sub) Build(domain *tld.Domain) {
  sub.channel = domain.Channel(&quot;requests&quot;)
}
</code></pre>

<h3 id="the-hello-and-world-services">The &ldquo;hello&rdquo; and &ldquo;world&rdquo; Services</h3>

<p>Like in the root domain, we will create two instances of the Word service, one returning &ldquo;hello&rdquo; and one returning &ldquo;world&rdquo;.  Register the instances with the domain using the <a href="https://godoc.org/gopkg.in/microlith.v0/sam/tld#DomainBuilder.Service">Service()</a> method on the domain builder.</p>

<pre><code class="language-go">func (sub *Sub) Build(domain *tld.DomainBuilder) {
  // ... Same as before ...

  sub.helloSvc = NewWord(&quot;hello&quot;, sub.requests)
  sub.worldSvc = NewWord(&quot;world&quot;, sub.requests)

  domain.Service(&quot;hello&quot;, sub.helloSvc)
  domain.Service(&quot;world&quot;, sub.worldSvc)
}
</code></pre>

<h3 id="the-hello-subdomain-world-endpoint">The &ldquo;hello-subdomain-world&rdquo; Endpoint</h3>

<p>Next, we need to add a &ldquo;hello-subdomain-world&rdquo; endpoint to the domain&rsquo;s origin.  This endpoint needs to call the &ldquo;hello&rdquo; and &ldquo;world&rdquo; services and construct the &ldquo;Hello, subdomain world!&rdquo; response.</p>

<p>The only difference between this endpoint and the &ldquo;hello-world&rdquo; endpoint is the response.  Let&rsquo;s just extend the existing Lambda to support this.  First, we&rsquo;ll add an instance variable to hold the infix string and extend the constructor to populate it.</p>

<pre><code class="language-go">type helloWorld struct {
  // ... Same as before ...

  infix string
}

func newHelloWorld(hello, world *Word, requests *strm.Stream, infix string) rest.Handler {
  return &amp;helloSubdomainWorld{
    helloSvc: hello,
    worldSvc: world,
    requests: requests,
    infix:    infix,
  }
}
</code></pre>

<p>And then we&rsquo;ll refactor the endpoint to include the infix string if it&rsquo;s not blank.</p>

<pre><code class="language-go">func (endpoint *helloWorld) ServeREST(ctx context.Context, req events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {
  // ... Same as before ...

  helloWorld := fmt.Sprintf(&quot;%s, %s!&quot;, strings.Title(hello), world)
  if endpoint.infix != &quot;&quot; {
    helloWorld = fmt.Sprintf(&quot;%s, %s %s!&quot;, string.Title(hello), endpoint.infix, world)
  }

  // ... Same as before ...
}
</code></pre>

<p>The domain builder has an <a href="https://godoc.org/gopkg.in/microlith.v0/sam/tld#DomainBuilder.Origin">Origin()</a> method to define the API with a &ldquo;hello-subdomain-world&rdquo; endpoint.  We&rsquo;ll create an instance of the Lambda with &ldquo;subdomain&rdquo; infix as our handler, and we&rsquo;ll capture the endpoint variable so we can create the client method.</p>

<pre><code class="language-go">func (sub *Sub) Build(domain *tld.DomainBuilder) {
  // ... Same as before ...

  domain.Origin(func(api *rest.APIBuilder) {
    scope.Get(&quot;hello-subdomain-world&quot;, newHelloWorld(sub.helloSvc, sub.worldSvc, sub.requests, &quot;subdomain&quot;), &amp;sub.endpoint)
  })
}
</code></pre>

<h3 id="the-hellosubdomainworld-method">The HelloSubdomainWorld() Method</h3>

<p>The HelloSubdomainWorld() method on the domain object it the client method.  It uses the captured endpoint object to call the &ldquo;hello-subdomain-world&rdquo; endpoint on the service.</p>

<pre><code class="language-go">func (sub *Sub) HelloSubdomainWorld(ctx context.Context) (string, error) {
  resp, err := sub.endpoint.Call(ctx, nil)
  if err != nil {
    return &quot;&quot;, err
  }

  switch resp.StatusCode {
  case http.StatusOK:
    msg := &quot;&quot;
    if err := rest.ResponseBody(resp, &amp;msg); err != nil {
      return &quot;&quot;, err
    }
    return msg, nil
  default:
    err := rest.ErrorResponse(resp, nil)
    return &quot;&quot;, err
  }
}
</code></pre>

<h2 id="the-root-domain">The Root Domain</h2>

<p>Now that we have the Sub domain, we can add it to the application.  Subdomains are directly routable via their DNS name, but they can also be called by the root domain.</p>

<p>We&rsquo;ll create an instance of the domain and register it with the application.  Then we&rsquo;ll add an endpoint to the root domain&rsquo;s origin to call the subdomain.</p>

<h3 id="domain-instance">Domain Instance</h3>

<p>Use the <a href="https://godoc.org/gopkg.in/microlith.v0#Subdomain">microlith.Subdomain()</a> function to register the domain with the application.  Each domain is mounted under a unique subdomain prefix.  We&rsquo;ll simply use &ldquo;sub&rdquo;.</p>

<pre><code class="language-go">func init() {
  // ... Same as before ...

  sub := NewSub()
  microlith.Subdomain(&quot;sub&quot;, sub)

  // ... Same as before ...
}
</code></pre>

<h3 id="the-proxy-to-subdomain-endpoint">The &ldquo;proxy-to-subdomain&rdquo; Endpoint</h3>

<p>The &ldquo;proxy-to-subdomain&rdquo; endpoint on the root origin will call the &ldquo;hello-subdomain-world&rdquo; endpoint on the &ldquo;sub&rdquo; domain.</p>

<p>Create a endpoint Lambda that takes the domain as an argument.  In the function, call the HelloSubdomainWorld() method on the domain and return the response.</p>

<pre><code class="language-go">type subdomainProxy struct {
  sub *Sub
}

func newSubdomainProxy(sub *Sub) rest.Handler {
  return &amp;subdomainProxy{sub}
}

func (endpoint *subdomainProxy) ServeREST(ctx context.Context, req events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {
  msg, err := endpoint.sub.HelloSubdomainWorld(ctx)
  if err != nil {
    return rest.Respond(http.StatusInternalServerError, err)
  }

  return rest.Respond(http.StatusOK, msg)
}
</code></pre>

<p>We want to mount the endpoint at &ldquo;GET /proxy/to/subdomain&rdquo;.  To create nested paths in an API, use the <a href="https://godoc.org/gopkg.in/microlith.v0/sam/tld/rest#APIBuilder.Scope">Scope()</a> method.  Within the builder, use the same HTTP method you use on the API builder.</p>

<p>While we&rsquo;re in the root origin, we need to fix it to use the updated constructor for the &ldquo;hello-world&rdquo; endpoint.</p>

<pre><code class="language-go">func init() {
  // ... Same as before ...

  microlith.Origin(func(api *rest.APIBuilder) {
    api.Get(&quot;hello-world&quot;, newHelloWorld(helloSvc, worldSvc, requests, &quot;&quot;), nil)

    api.Scope(&quot;/proxy/to/subdomain&quot;, func(scope *rest.ScopeBuilder) {
      scope.Get(&quot;proxy-to-subdomain&quot;, newSubdomainProxy(sub), nil)
    })
  })
}
</code></pre>

<h2 id="ship-it">Ship It</h2>

<p>Now your app has a subdomain that mirrors the root domain.  Deploy your app:</p>

<pre><code class="language-bash">git add .
git commit -m &quot;Added a subdomain&quot;
git push origin master
</code></pre>

<div class="notices info" ><p>Adding a subdomain causes Microlith to issue new SSL certificates.  The contact for the validation domain will get another ACM certificate confirmation.  The build pipeline will stall until the confirmation is completed.</p>
</div>


<p>Now you can make requests against the subdomain either directly or via the proxy endpoint:</p>

<pre><code class="language-bash"># Direct request
curl https://sub.tutorial.my-domain.com/

# Via the proxy endpoint
curl https://tutorial.my-domain.com/proxy/to/subdomain
</code></pre>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/tutorial/channels/" title="Channels"> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/tutorial/globals/" title="Globals" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1542658311"></script>
    <script src="/js/perfect-scrollbar.min.js?1542658311"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1542658311"></script>
    <script src="/js/jquery.sticky.js?1542658311"></script>
    <script src="/js/featherlight.min.js?1542658311"></script>
    <script src="/js/html5shiv-printshiv.min.js?1542658311"></script>
    <script src="/js/highlight.pack.js?1542658311"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1542658311"></script>
    <script src="/js/learn.js?1542658311"></script>
    <script src="/js/hugo-learn.js?1542658311"></script>

    <link href="/mermaid/mermaid.css?1542658311" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1542658311"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

